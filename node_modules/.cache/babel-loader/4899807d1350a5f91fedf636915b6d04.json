{"ast":null,"code":"import React,{useEffect,useState}from'react';import axiosInstance from'../axiosConfig';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UpdateProfile=()=>{const[userData,setUserData]=useState({username:'',email:'',firstname:'',lastname:'',phoneNumber:'',birthdate:''// Add birthdate field\n});const navigate=useNavigate();useEffect(()=>{const fetchUserData=async()=>{const user=JSON.parse(localStorage.getItem('user'));if(user){// Convert birthdate to YYYY-MM-DD format if it exists\nconst formattedBirthdate=user.birthdate?user.birthdate.split('/').reverse().join('-')// Converts dd/MM/yyyy to yyyy-MM-dd\n:'';// Set to empty string if no birthdate\nsetUserData({...user,birthdate:formattedBirthdate});// Populate the form with user data\n}else{console.error('No user data found, user not authenticated.');navigate('/login');// Redirect to login if not authenticated\n}};fetchUserData();},[navigate]);const handleChange=e=>{const{name,value}=e.target;setUserData({...userData,[name]:value});};const handleSubmit=async e=>{e.preventDefault();const token=localStorage.getItem('token');// Check if the token is available\nif(!token){console.error('No token found. User is not authenticated.');navigate('/login');// Redirect if no token\nreturn;}// Ensure the birthdate is in the correct format (YYYY-MM-DD)\nconst updatedUserData={...userData,birthdate:userData.birthdate.split('-').reverse().join('/')// Convert back to dd/MM/yyyy for storage\n};console.log('Token being sent:',token);console.log('User data being sent:',updatedUserData);// Log user data for debugging\ntry{const response=await axiosInstance.put('/api/user/update',updatedUserData,{headers:{Authorization:`Bearer ${token}`}});console.log('Profile updated:',response.data);alert('Profile updated successfully!');localStorage.setItem('user',JSON.stringify(response.data));navigate('/dashboard');}catch(error){console.error('Error updating profile:',error.response?error.response.data:error.message);alert('Error updating profile. Please check your credentials and try again.');// Inform the user of the error\n}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Update Profile\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Username:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"username\",value:userData.username,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Email:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",value:userData.email,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"First Name:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"firstname\",value:userData.firstname,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Last Name:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"lastname\",value:userData.lastname,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Phone Number:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"phoneNumber\",value:userData.phoneNumber,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Date of Birth:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"birthdate\",value:userData.birthdate,onChange:handleChange})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Update Profile\"})]})]});};export default UpdateProfile;","map":{"version":3,"names":["React","useEffect","useState","axiosInstance","useNavigate","jsx","_jsx","jsxs","_jsxs","UpdateProfile","userData","setUserData","username","email","firstname","lastname","phoneNumber","birthdate","navigate","fetchUserData","user","JSON","parse","localStorage","getItem","formattedBirthdate","split","reverse","join","console","error","handleChange","e","name","value","target","handleSubmit","preventDefault","token","updatedUserData","log","response","put","headers","Authorization","data","alert","setItem","stringify","message","children","onSubmit","type","onChange","required"],"sources":["/home/rouaa/Desktop/social-media-front/src/components/UpdateProfile.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport axiosInstance from '../axiosConfig';\nimport { useNavigate } from 'react-router-dom';\n\nconst UpdateProfile = () => {\n    const [userData, setUserData] = useState({\n        username: '',\n        email: '',\n        firstname: '',\n        lastname: '',\n        phoneNumber: '',\n        birthdate: '',  // Add birthdate field\n    });\n    const navigate = useNavigate();\n\n    useEffect(() => {\n        const fetchUserData = async () => {\n            const user = JSON.parse(localStorage.getItem('user'));\n            if (user) {\n                // Convert birthdate to YYYY-MM-DD format if it exists\n                const formattedBirthdate = user.birthdate \n                    ? user.birthdate.split('/').reverse().join('-') // Converts dd/MM/yyyy to yyyy-MM-dd\n                    : ''; // Set to empty string if no birthdate\n                setUserData({ ...user, birthdate: formattedBirthdate }); // Populate the form with user data\n            } else {\n                console.error('No user data found, user not authenticated.');\n                navigate('/login'); // Redirect to login if not authenticated\n            }\n        };\n\n        fetchUserData();\n    }, [navigate]);\n\n    const handleChange = (e) => {\n        const { name, value } = e.target;\n        setUserData({\n            ...userData,\n            [name]: value,\n        });\n    };\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        const token = localStorage.getItem('token');\n\n        // Check if the token is available\n        if (!token) {\n            console.error('No token found. User is not authenticated.');\n            navigate('/login'); // Redirect if no token\n            return;\n        }\n\n        // Ensure the birthdate is in the correct format (YYYY-MM-DD)\n        const updatedUserData = {\n            ...userData,\n            birthdate: userData.birthdate.split('-').reverse().join('/'), // Convert back to dd/MM/yyyy for storage\n        };\n\n        console.log('Token being sent:', token);\n        console.log('User data being sent:', updatedUserData); // Log user data for debugging\n\n        try {\n            const response = await axiosInstance.put('/api/user/update', updatedUserData, {\n                headers: {\n                    Authorization: `Bearer ${token}`,\n                },\n            });\n            console.log('Profile updated:', response.data);\n            alert('Profile updated successfully!');\n\n            localStorage.setItem('user', JSON.stringify(response.data));\n            navigate('/dashboard');\n        } catch (error) {\n            console.error('Error updating profile:', error.response ? error.response.data : error.message);\n            alert('Error updating profile. Please check your credentials and try again.'); // Inform the user of the error\n        }\n    };\n\n    return (\n        <div>\n            <h2>Update Profile</h2>\n            <form onSubmit={handleSubmit}>\n                <div>\n                    <label>Username:</label>\n                    <input type=\"text\" name=\"username\" value={userData.username} onChange={handleChange} required />\n                </div>\n                <div>\n                    <label>Email:</label>\n                    <input type=\"email\" name=\"email\" value={userData.email} onChange={handleChange} required />\n                </div>\n                <div>\n                    <label>First Name:</label>\n                    <input type=\"text\" name=\"firstname\" value={userData.firstname} onChange={handleChange} required />\n                </div>\n                <div>\n                    <label>Last Name:</label>\n                    <input type=\"text\" name=\"lastname\" value={userData.lastname} onChange={handleChange} required />\n                </div>\n                <div>\n                    <label>Phone Number:</label>\n                    <input type=\"text\" name=\"phoneNumber\" value={userData.phoneNumber} onChange={handleChange} />\n                </div>\n                <div>\n                    <label>Date of Birth:</label>\n                    <input type=\"date\" name=\"birthdate\" value={userData.birthdate} onChange={handleChange} />\n                </div>\n                <button type=\"submit\">Update Profile</button>\n            </form>\n        </div>\n    );\n};\n\nexport default UpdateProfile;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}